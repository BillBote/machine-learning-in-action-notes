# 第十章 聚类和k均值聚类
对数据分类是一种常见分析方法，如果我们已知数据的类别并且已经给数据分好了类，那么我们可以利用分类方法（classification）进行分类。但是某些情况下，只有数据没有标签，我们怎么办。一个想法就是把相似的数据放到一起，这样就自然形成了几类。那么问题来了，什么样的数据是相似，也就是以什么样的标准定义相似度。直观的想法就是离的近的放一类呗，这就是用距离刻画相似度；或者相关系数大的方一起呗，这就是用相关系数刻画相似度。我们首先介绍这些度量。
## 10.1 标准
### 10.1.1 距离标准
z拿到数据第一反应一般是可视化，把数据处理为图像后，感觉聚类变得非常清晰——离得近的聚成一类。这就涉及到数据之间的距离。泛函分析里我们已经引入了距离公理，但聚类分析里的距离却不要求满足这些，我们记数据点$x=(x_1,x_2,...,x_n)$，以下是一些常用距离：

(i)欧氏距离，即L2范数：

$
d_{ij}^{(2)}=(\sum_{t=1}^n(x_i-x_j)^2)^{1/2}
$

(ii)Minkowski距离：

$
d_{ij}^{(q)}=(\sum_{t=1}^n|x_i-x_j|^q)^{1/q}
$

(iii)Chebyshev距离：

$
d_{ij}^{(c)}=\max\limits_{1\geq{t}\geq{n}}|x_{it}-x_{jt}|
$

(iv)马氏距离：

$
d_{ij}^{(m)}=(x_i-x_j)'V^{-1}(x_i-x_j)
$

其中，$V=\frac{1}{n}X'HX$，这里$H=I_n-\frac{1}{n}11'$，且V可逆

(v)兰氏距离：

$
d_{ij}^{(l)}=\sum_{t=1}^n\frac{|x_{it}-x_{jt}|}{x_{it}+x_{jt}}
$

一般在${x_{it},x_{jt},t=1,..,n}$都同号时使用。

上述各距离越小意味着数据点越接近，如果距离为0说明在某种意义下，两者是相同的。

### 8.1.2 相似系数
我们在多元统计中曾经引入过相关系数，即

$
r_{ij}^{(1)}=\frac{\sum_{t=1}^n(x_{ti}-\bar{x_i})(x_{tj}-\bar{x_j})}{(\sum_{t=1}^n(x_{ti}-\bar{x_i})^2\sum_{t=1}^n(x_{tj}-\bar{x_j})^2)^{1/2}}
$

此外，如果我们把数据点视为$R_n$空间上的向量，考虑两个向量之间的夹角，显然当夹角越小时两向量越接近，因此可以引出相似系数：

$
r_{ij}^{(2)}=\frac{\sum_{t=1}^nx_{ti}x_{tj}}{}
$

如果我们记以下表示：

$
\widetilde{x_{(i)}}=(x_{1i}-\bar{x_i},...,x_{ni}-\bar{x_i})'
$

那么我们发现$r_{ij}^{(1)}$实际上也是相似系数。

出于简单考虑，我们会使用同号率作为相关和相似系数的替代

即
$
n^+=x_{(i)}和x_{(j)}同号元素个数，n^-=x_{(i)}和x_{(j)}异号元素个数
$

那么$r_{ij}=\frac{n^+-n^-}{n^++n^-}$。对$\widetilde{x_{(i)}}$使用得到非参数相关系数，对$x_{(i)}$使用得到非参数相似系数。

除此之外，还有以下两种表示：

$
r_{ij}=\sum_{t=1}^n\min\limits_{i,j}(x_{ti},x_{tj})/\sum_{t=1}^n\max\limits_{i,j}(x_{ti},x_{tj})

r_{ij}=2\sum_{t=1}^n\min\limits_{i,j}(x_{ti},x_{tj})/\sum_{t=1}^n(x_{ti}+x_{tj})
$

上述式子均可用来计算相似度。

## 8.2 系统聚类
上一节介绍完聚类标准后，我们开始真正进入聚类。那么怎么开始呢？我们手上有数据点，作图？很直观但没法从图中直接得到类别，那么我们就先把各点看作不同的类，每次缩小类的数量不就ok了？这就是系统聚类的思路。把各点视为不同的类，进行迭代计算，每次迭代计算各类距离或相似系数，把最大的两类聚在一起，使总类数下降。这样我们会得到一个聚类图，由于类数不断减少，我们计算出的聚类标准不断减小，因此只要我们给定一个最小标准值，就能在聚类图中找到对应的聚类情况。

我们列出具体步骤

1.将每一个数据点视为一个类，计算类之间的归类指标（相似系数取绝对值），将指标值最大的归为一类；

2.确定新类的归类指标和归类方法，这有好几种方法，我们之后再说，计算得到新类的指标值；

3.逐次归类，即重复第2步操作，直到所有数据归为一类为止；

4.绘制聚类图，根据实际需要选择归类数目或指标值的阈值，在图中选出分类情况。

关于新类的归类指标计算，有综合变量法、平均系数法、最大系数法、最小系数法等。

综合变量法：把新类中的变量进行加权求和作为新类别的变量；

平均系数法：对分到新类中的变量关于其他类别变量的指标进行加权求和得到新变量和其他变量之间的指标值；

最大系数法：取新变量中各类关于其他类别的指标值的最大值作为新变量的指标值；

最小系数法：取新变量中各类关于其他类别的指标值的最小值作为新变量的指标值；



